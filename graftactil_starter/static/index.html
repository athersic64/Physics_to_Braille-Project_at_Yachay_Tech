<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GrafTactil — Editor gráfico (Live 3D)</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- estilos propios -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- mathjs (global "math") para parsear expresiones del usuario -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
</head>
<body>
  <div class="container py-3">
    <h1 class="mb-3">GrafTactil — Editor gráfico</h1>

    <!-- Sección 1: Configuración general -->
    <section class="card p-3 mb-3" id="section-general">
      <h5>Configuración general</h5>
      <div class="row g-2 align-items-end">
        <div class="col-md-3">
          <label class="form-label">Tamaño placa (mm)</label>
          <div class="input-group">
            <input id="fig_w" type="number" class="form-control" value="173" min="10">
            <input id="fig_h" type="number" class="form-control" value="113" min="10">
          </div>
          <div class="small-muted">Ancho × Alto</div>
        </div>
        <div class="col-md-2">
          <label class="form-label">DPI</label>
          <input id="dpi" class="form-control" type="number" value="96">
        </div>
        <div class="col-md-2">
          <label class="form-label">Grosor placa (mm)</label>
          <input id="plate_thickness_mm" class="form-control" type="number" step="0.1" value="0.8">
        </div>
        <div class="col-md-2">
          <label class="form-label">Altura marcador (mm)</label>
          <input id="marker_height_mm" class="form-control" type="number" step="0.1" value="0.8">
        </div>
        <div class="col-md-3">
          <label class="form-label">Export filename</label>
          <input id="output_filename" class="form-control" type="text" value="grafica_export.stl">
        </div>
      </div>
      <div class="form-check form-switch mt-2">
        <input class="form-check-input" type="checkbox" id="only_markers" checked>
        <label class="form-check-label" for="only_markers">Solo marcadores (ocultar curvas)</label>
      </div>
      <div class="form-check form-switch mt-1">
        <input class="form-check-input" type="checkbox" id="live_preview" checked>
        <label class="form-check-label" for="live_preview">Vista 3D en tiempo real</label>
        <div class="small-muted">Si está activo, el visor se actualiza automáticamente al cambiar parámetros.</div>
      </div>
    </section>

    <!-- Sección 2: funciones -->
    <section class="card p-3 mb-3" id="section-functions">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Funciones (marcadores)</h5>
        <div>
          <button id="addFn" class="btn btn-sm btn-primary">Agregar función</button>
        </div>
      </div>
      <div id="functionsList" class="mt-3"></div>

      <!-- plantilla para fila editable -->
      <template id="fnTemplate">
        <div class="row align-items-end function-row g-2">
          <div class="col-md-4">
            <label class="form-label">Expresión (x)</label>
            <input class="form-control fn-expr" placeholder="ej: x, x**2, sin(x)" value="x">
            <div class="small-muted">Usa sin, cos, exp, log, etc.</div>
          </div>
          <div class="col-md-2">
            <label class="form-label">Marcadores (N)</label>
            <input class="form-control fn-density" type="number" value="20" min="0">
          </div>
          <div class="col-md-2">
            <label class="form-label">Forma</label>
            <select class="form-select fn-shape">
              <option value="o" selected>Círculo</option>
              <option value="s">Cuadrado</option>
              <option value="^">Triángulo</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Tamaño (mm)</label>
            <input class="form-control fn-size" type="number" step="0.1" value="3.0" min="0.5">
          </div>
          <div class="col-md-1">
            <button class="btn btn-danger remove-fn">Eliminar</button>
          </div>
        </div>
      </template>
    </section>

    <!-- controles -->
    <div class="d-flex gap-2 mb-3">
      <button id="generateBtn" class="btn btn-success">Generar STL (backend)</button>
      <button id="previewBtn" class="btn btn-outline-primary">Actualizar vista 3D</button>
      <button id="resetBtn" class="btn btn-outline-secondary">Reset</button>
      <div id="status" class="align-self-center small-muted"></div>
    </div>

    <!-- Sección 3: preview + visor 3D -->
    <div class="row g-3">
      <div class="col-md-6">
        <div id="preview" class="card p-2"></div>
      </div>
      <div class="col-md-6">
        <div class="card p-2">
          <h6>Visor 3D</h6>
          <div id="viewer" class="viewer-box"></div>
          <div class="mt-2 d-flex justify-content-between">
            <div id="viewerStatus" class="small-muted"></div>
            <div>
              <button id="resetView" class="btn btn-sm btn-outline-secondary">Reset cámara</button>
              <a id="downloadStlBtn" class="btn btn-sm btn-primary" href="#" target="_blank" style="display:none;">Descargar STL</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="rawJson" style="display:none;"></div>
  </div>

  <!-- three.js + loaders serán importados en app.js (module) -->
  <script type="module" src="/static/app.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>